<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Factories &middot; Ember CLI Mirage
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/style.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <div class="Topbar">
      <div class="Container">
      </div>
    </div>

    <header class="Header">
  <div class="Container">
    <nav class='Header__nav'>
      <ul class='Header__nav-list'>
        <li class='Header__nav-item'>
          <a href='/docs/v0.3.x' class="Header__nav-item-link active">
            <span class="u-mobile">Docs</span>
            <span class="u-desktop">Documentation</span>
          </a>
        </li>
        <li class='Header__nav-item'>
          <a href='/blog' class="Header__nav-item-link">Blog</a>
        </li>
        <li class='Header__nav-item'>
          <a href='/about' class="Header__nav-item-link">About</a>
        </li>
        <li class='Header__nav-item'>
          <a href="http://localhost:4000" class='Header__nav-item-link' target="_blank">GitHub</a>
        </li>
      </ul>
    </nav>
    <a class="Header__logo" href="/">
      <span class='Header__logo-minor'>Ember CLI</span><br>
      <span class='Header__logo-major'>Mirage</span>
    </a>
  </div>
</header>


    <div class="Wrapper">
      <div class="Content">
        

<div class="Side-panel">

  <div class="Mobile-nav">
    <select class="Mobile-nav__toc" onchange="if (this.value) window.location.href=this.value">
      <option value="">Navigate the docs...</option>
      
        


  
  <optgroup label='Getting started'>

<option value="/docs/v0.2.x/">Overview</option>


      
        


<option value="/docs/v0.2.x/installation/">Installation</option>


      
        


<option value="/docs/v0.2.x/quickstart/">Quickstart</option>


      
        


<option value="/docs/v0.2.x/upgrading/">Upgrading</option>


      
        


  
    </optgroup>
  
  <optgroup label='Writing your server'>

<option value="/docs/v0.2.x/defining-routes/">Defining routes</option>


      
        


<option value="/docs/v0.2.x/seeding-your-database/">Seeding your database</option>


      
        


<option value="/docs/v0.2.x/acceptance-testing/">Acceptance testing</option>


      
        


  
    </optgroup>
  
  <optgroup label='API'>

<option value="/docs/v0.2.x/configuration/">Configuration</option>


      
        


<option value="/docs/v0.2.x/collections/">Collections</option>


      
        


<option value="/docs/v0.2.x/route-handlers/">Route handlers</option>


      
        


<option value="/docs/v0.2.x/database/">Database</option>


      
        


<option value="/docs/v0.2.x/factories/">Factories</option>


      
        


<option value="/docs/v0.2.x/fixtures/">Fixtures</option>


      
        


<option value="/docs/v0.2.x/models/">Models</option>


      
        


<option value="/docs/v0.2.x/schema/">Schema</option>


      
        


<option value="/docs/v0.2.x/serializers/">Serializers</option>


      
        


<option value="/docs/v0.2.x/shorthands/">Shorthands</option>


      
        


  
    </optgroup>
  
  <optgroup label='Cookbook'>

<option value="/docs/v0.2.x/manually-starting-mirage/">Manually starting Mirage</option>


      
        


<option value="/docs/v0.2.x/simulating-cookie-responses/">Simulating cookie responses</option>

  </optgroup>


      
    </select>

    <div class="Mobile-nav__version">
      <span class='Mobile-nav__version-label'>Version: </span>
      <select class='Mobile-nav__version-select' onchange="if (this.value) window.location.href=this.value">
        
          <option value="/docs/v0.3.x" >v0.3.x</option>
        
          <option value="/docs/v0.2.x" selected >v0.2.x</option>
        
          <option value="/docs/v0.1.x" >v0.1.x</option>
        
          <option value="/docs/v0.0.29" >v0.0.29</option>
        
          <option value="/docs/v0.0.28" >v0.0.28</option>
        
          <option value="/docs/v0.0.27" >v0.0.27</option>
        
      </select>
    </div>
  </div>

  <div class="Desktop-nav">
    <div class="Desktop-nav__version">
      <span class="Desktop-nav__version-label">Version: </span>
      <select class='Desktop-nav__version-select' onchange="if (this.value) window.location.href=this.value">
        
        <option value="/docs/v0.3.x" >v0.3.x</option>
        
        <option value="/docs/v0.2.x" selected >v0.2.x</option>
        
        <option value="/docs/v0.1.x" >v0.1.x</option>
        
        <option value="/docs/v0.0.29" >v0.0.29</option>
        
        <option value="/docs/v0.0.28" >v0.0.28</option>
        
        <option value="/docs/v0.0.27" >v0.0.27</option>
        
      </select>
    </div>

    <ul class="Desktop-nav__toc">
      
        
          <li class='Desktop-nav__section'>Getting started</li>
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/">
    Overview
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/installation/">
    Installation
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/quickstart/">
    Quickstart
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/upgrading/">
    Upgrading
  </a>
</li>

      
        
          <li class='Desktop-nav__section'>Writing your server</li>
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/defining-routes/">
    Defining routes
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/seeding-your-database/">
    Seeding your database
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/acceptance-testing/">
    Acceptance testing
  </a>
</li>

      
        
          <li class='Desktop-nav__section'>API</li>
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/configuration/">
    Configuration
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/collections/">
    Collections
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/route-handlers/">
    Route handlers
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/database/">
    Database
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item active" href="/docs/v0.2.x/factories/">
    Factories
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/fixtures/">
    Fixtures
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/models/">
    Models
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/schema/">
    Schema
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/serializers/">
    Serializers
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/shorthands/">
    Shorthands
  </a>
</li>

      
        
          <li class='Desktop-nav__section'>Cookbook</li>
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/manually-starting-mirage/">
    Manually starting Mirage
  </a>
</li>

      
        

        

<li>
  <a class="Desktop-nav__item " href="/docs/v0.2.x/simulating-cookie-responses/">
    Simulating cookie responses
  </a>
</li>

      
    </ul>
  </div>
</div>


<div class="Center-panel">

  <div class="Docs-page">
    <div class='Docs-page__header'>
      <div class="Docs-page__version">
        <a class='Docs-page__improve' href="https://github.com/samselikoff/ember-cli-mirage/edit/gh-pages/docs/v0.2.x/factories.md">
          <small>
            <img class='Docs-page__improve-img' src="/public/images/edit.png" alt="">
            <span class='Docs-page__improve-text'>Improve this page</span>
          </small>
        </a>
      </div>
      <h1 class='Docs-page__title'>Factories</h1>
    </div>

    <div class='Docs-page__content'>
      <p>Factories are used to seed your database, either during development or within tests. Whenever you generate an object via a factory, it will automatically get added to the database, and thus get an autogenerated <code class="highlighter-rouge">id</code>.</p>

<p>You define factories by using the <code class="highlighter-rouge">ember g mirage-factory [name]</code> command, or creating files under the <code class="highlighter-rouge">mirage/factories</code> directory. The name of the factory is determined by the filename.</p>

<p>Factories have attributes, and you create objects from factory definitions using the <code class="highlighter-rouge">server.create</code> and <code class="highlighter-rouge">server.createList</code> methods.</p>

<h2 id="defining-factories">Defining factories</h2>

<p>Attributes can be static (strings, numbers or booleans) or dynamic (a function). Here’s a factory with some static attributes:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/user.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Link'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">563</span><span class="p">,</span>
  <span class="na">evil</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Functions receive the sequence number <em>i</em> as an argument, which is useful to create dynamic attributes:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/user.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">name</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'User '</span> <span class="o">+</span> <span class="nx">i</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p>The first user generated (per test) would have a name of <code class="highlighter-rouge">User 1</code>, the second a name of <code class="highlighter-rouge">User 2</code>, and so on.</p>

<aside class="Docs-page__aside">
  <p>Referencing other attributes from within dynamic attributes is only available in 2.4 and later.</p>
</aside>

<p>Finally, you can also reference attributes from within a dynamic attribute via <code class="highlighter-rouge">this</code>:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/contact.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="na">age</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>

  <span class="nx">isAdmin</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">});</span>
</code></pre>
</div>

<p>This even works with other dynamic attributes:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/contact.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="nx">email</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="err">`</span><span class="nx">email$</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="err">@</span><span class="nx">acme</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">isAdmin</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span> <span class="o">===</span> <span class="s1">'email1@acme.com'</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">});</span>
</code></pre>
</div>

<p>You’ll get an error if you create an invalid cycle of dynamic attributes.</p>

<p>You can also customize the objects created by your factory using the
<code class="highlighter-rouge">afterCreate()</code> hook. This hook fires after the object is built (so all the
attributes you’ve defined will be populated) but before that object is returned.</p>

<p>The <code class="highlighter-rouge">afterCreate()</code> method is given two arguments: the newly created object, and
a reference to the server. This makes it useful if you want your factory-created
objects to be aware of the rest of the state of your Mirage database, or build
relationships (as we’ll see in a moment):</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/contact.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">faker</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="na">isAdmin</span><span class="p">:</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="kr">boolean</span><span class="p">,</span>

  <span class="nx">afterCreate</span><span class="p">(</span><span class="nx">contact</span><span class="p">,</span> <span class="nx">server</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only allow a max of 5 admins to be created</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">contacts</span><span class="p">.</span><span class="nx">where</span><span class="p">({</span> <span class="na">isAdmin</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">models</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">contact</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="na">isAdmin</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">});</span>
</code></pre>
</div>

<hr />

<p>You should define the attributes of your factory as the “base case” for your objects, and override them within your tests. We’ll discuss how do to this in the Creating Objects section.</p>

<h2 id="factories-and-relationships">Factories and relationships</h2>

<p>When building objects using factories, you may want to create related objects automatically. To build related objects for <code class="highlighter-rouge">belongsTo</code> relationships, you can use <code class="highlighter-rouge">association</code> helper.</p>

<p>Start with defining relationships in your models so that they can be introspected for the details like relationship name:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/models/article.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">belongsTo</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">author</span><span class="p">:</span> <span class="nx">belongsTo</span><span class="p">()</span>
<span class="p">});</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/models/author.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">();</span>
</code></pre>
</div>

<p>And simply indicate which attributes are <code class="highlighter-rouge">association</code>s:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/article.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">association</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'ember-cli-mirage rockzzz'</span><span class="p">,</span>
  <span class="na">author</span><span class="p">:</span> <span class="nx">association</span><span class="p">()</span>
<span class="p">});</span>
</code></pre>
</div>

<p>You can also pass a list of traits and overrides as arguments to <code class="highlighter-rouge">association</code> helper:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/author.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">trait</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">withNames</span><span class="p">:</span> <span class="nx">trait</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="s1">'Yehuda'</span><span class="p">,</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Katz'</span>
  <span class="p">})</span>
<span class="p">});</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/article.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">association</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'ember-cli-mirage rockzzz'</span><span class="p">,</span>
  <span class="na">author</span><span class="p">:</span> <span class="nx">association</span><span class="p">(</span><span class="s1">'withNames'</span><span class="p">,</span> <span class="p">{</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Dale'</span> <span class="p">})</span>
<span class="p">});</span>
</code></pre>
</div>

<p>You can also use the <code class="highlighter-rouge">afterCreate()</code> hook (for both <code class="highlighter-rouge">hasMany</code> and <code class="highlighter-rouge">belongsTo</code> relationships):</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/author.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">faker</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">firstName</span><span class="p">:</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
  <span class="nx">afterCreate</span><span class="p">(</span><span class="nx">author</span><span class="p">,</span> <span class="nx">server</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'post'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">author</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Because the <code class="highlighter-rouge">afterCreate()</code> hook is called with the newly created object a reference to the server, you can construct complex object graphs to associate with your newly created object.</p>

<h2 id="traits">Traits</h2>

<p>Factory traits make it easy to group related attributes:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/post.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">trait</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Lorem ipsum'</span><span class="p">,</span>

  <span class="na">published</span><span class="p">:</span> <span class="nx">trait</span><span class="p">({</span>
    <span class="na">isPublished</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">publishedAt</span><span class="p">:</span> <span class="s1">'2010-01-01 10:00:00'</span>
  <span class="p">})</span>
<span class="p">});</span>
</code></pre>
</div>

<p>You can pass anything into <code class="highlighter-rouge">trait</code> that you can into the base factory.</p>

<p>To use a trait, pass the trait name in as string argument to <code class="highlighter-rouge">server.create</code>:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'post'</span><span class="p">,</span> <span class="s1">'published'</span><span class="p">);</span>
</code></pre>
</div>

<p>You can also compose multiple traits together:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/post.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">trait</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Lorem ipsum'</span><span class="p">,</span>

  <span class="na">published</span><span class="p">:</span> <span class="nx">trait</span><span class="p">({</span>
    <span class="na">isPublished</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">publishedAt</span><span class="p">:</span> <span class="s1">'2010-01-01 10:00:00'</span>
  <span class="p">}),</span>

  <span class="na">official</span><span class="p">:</span> <span class="nx">trait</span><span class="p">({</span>
    <span class="na">isOfficial</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">})</span>
<span class="p">});</span>

<span class="c1">// Use</span>
<span class="kd">let</span> <span class="nx">officialPost</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'post'</span><span class="p">,</span> <span class="s1">'official'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">officialPublishedPost</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'post'</span><span class="p">,</span> <span class="s1">'official'</span><span class="p">,</span> <span class="s1">'published'</span><span class="p">);</span>
</code></pre>
</div>

<p>As always, you can pass in an <code class="highlighter-rouge">attrs</code> hash as the last argument for attribute overrides:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'post'</span><span class="p">,</span> <span class="s1">'published'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'My first post'</span> <span class="p">});</span>
</code></pre>
</div>

<p>When combined with the <code class="highlighter-rouge">afterCreate()</code> hook, traits simplify the process of setting up related object graphs. Here we create 10 posts each having 3 associated comments:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/post.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">trait</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Lorem ipsum'</span><span class="p">,</span>

  <span class="na">published</span><span class="p">:</span> <span class="nx">trait</span><span class="p">({</span>
    <span class="na">isPublished</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">publishedAt</span><span class="p">:</span> <span class="s1">'2010-01-01 10:00:00'</span>
  <span class="p">}),</span>

  <span class="na">withComments</span><span class="p">:</span> <span class="nx">trait</span><span class="p">({</span>
    <span class="nx">afterCreate</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="nx">server</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">server</span><span class="p">.</span><span class="nx">createList</span><span class="p">(</span><span class="s1">'comment'</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span> <span class="nx">post</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">});</span>

<span class="c1">// Use</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">createList</span><span class="p">(</span><span class="s1">'post'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">'withComments'</span><span class="p">);</span>
</code></pre>
</div>

<p>Traits improve your test suite by pulling unnecessary knowledge about data setup out of your tests. If you’re writing a test module to verify the behavior of a comment box on a blog post page, each test will need a post to exist as part of its setup. If a post requires a user, and that user requires a session and perhaps a subscription, you don’t want to repeat this knowledge in each of your comment tests. Instead, create a trait that has meaning within your domain - say, a published post - to simplify the data setup needed to write each of your comment tests. This leads to a more concise, expressive test suite, which will help future developers who come into your codebase better understand the expected behavior of your application.</p>

<h2 id="using-fakerjs">Using Faker.js</h2>

<p>The <a href="https://github.com/marak/Faker.js/">Faker.js</a> library is included with Mirage, and its methods work nicely with factory definitions:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/user.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">faker</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">firstName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">firstName</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">lastName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">lastName</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">avatar</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">internet</span><span class="p">.</span><span class="nx">avatar</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p>We’ve also added two methods on the <code class="highlighter-rouge">faker</code> namespace, <code class="highlighter-rouge">list.cycle</code> and <code class="highlighter-rouge">list.random</code>, which are useful if you have a set of data you want your factories to iterate through:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/subject.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span><span class="p">,</span> <span class="nx">faker</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">cycle</span><span class="p">(</span><span class="s1">'Economics'</span><span class="p">,</span> <span class="s1">'Philosophy'</span><span class="p">,</span> <span class="s1">'English'</span><span class="p">,</span> <span class="s1">'History'</span><span class="p">,</span> <span class="s1">'Mathematics'</span><span class="p">),</span>
  <span class="na">students</span><span class="p">:</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="p">});</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">cycle</code> loops through the data in order, while <code class="highlighter-rouge">random</code> chooses a random element from the list each time an object is created.</p>

<p>View <a href="https://github.com/marak/Faker.js/">Faker’s docs</a> for the full faker API.</p>

<h2 id="extending-factories">Extending factories</h2>

<p>You can extend factories:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/factories/human.js</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Factory</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'ember-cli-mirage'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">species</span><span class="p">:</span> <span class="s1">'homo sapiens'</span>
<span class="p">});</span>

<span class="c1">// mirage/factories/man.js</span>
<span class="kr">import</span> <span class="nx">Human</span> <span class="nx">from</span> <span class="s1">'./human'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Human</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">gender</span><span class="p">:</span> <span class="s1">'male'</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="creating-objects">Creating objects</h2>

<p>Once you’ve defined a factory for a model, you can generate data for that model using <code class="highlighter-rouge">server.create</code> and <code class="highlighter-rouge">server.createList</code>, either from within <code class="highlighter-rouge">mirage/scenarios/default.js</code> for development, or from within your acceptance tests.</p>

<p><a name="create" href="#create">#</a> server.<b>create</b>(<i>type</i> [, <i>attrs</i>])</p>

<p>Generates a single model of type <em>type</em>, inserts it into the database (giving it an id), and returns the data that was
added.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s2">"I can view a contact's details"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">contact</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">);</span>

  <span class="nx">visit</span><span class="p">(</span><span class="s1">'/contacts/'</span> <span class="o">+</span> <span class="nx">contact</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

  <span class="nx">andThen</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">equal</span><span class="p">(</span> <span class="nx">find</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span> <span class="s1">'The contact is Link'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>You can override the attributes from the factory definition with a
hash passed in as the second parameter. For example, if we had this factory</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">export</span> <span class="k">default</span> <span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Link'</span>
<span class="p">});</span>
</code></pre>
</div>

<p>we could override the name like this:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s2">"I can view the contacts"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">,</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Zelda'</span><span class="p">});</span>

  <span class="nx">visit</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>

  <span class="nx">andThen</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">equal</span><span class="p">(</span> <span class="nx">find</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span> <span class="s1">'Zelda'</span> <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p><a name="createList" href="#createList">#</a> server.<b>createList</b>(<i>type</i>, <i>amount</i> [, <i>attrs</i>])</p>

<p>Creates <em>amount</em> models of type <em>type</em>, optionally overriding the attributes from the factory with <em>attrs</em>.</p>

<p>Returns the array of records that were added to the database.</p>

<p>Here’s an example from a test:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s2">"I can view the contacts"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">server</span><span class="p">.</span><span class="nx">createList</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">youngContacts</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">createList</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">{</span><span class="na">age</span><span class="p">:</span> <span class="mi">15</span><span class="p">});</span>

  <span class="nx">visit</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>

  <span class="nx">andThen</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">equal</span><span class="p">(</span><span class="nx">currentRouteName</span><span class="p">(),</span> <span class="s1">'index'</span><span class="p">);</span>
    <span class="nx">equal</span><span class="p">(</span> <span class="nx">find</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">10</span> <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>And one from setting up your development database:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// mirage/scenarios/default.js</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span><span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">contact</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">);</span>
  <span class="nx">server</span><span class="p">.</span><span class="nx">createList</span><span class="p">(</span><span class="s1">'address'</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">{</span><span class="na">contactId</span><span class="p">:</span> <span class="nx">contact</span><span class="p">.</span><span class="nx">id</span><span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>

    </div>

    

<div class='Docs-page-nav'>
  
    
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
      
      
      
        
  
         <a class="Docs-page-nav__link u-first" href="/docs/v0.2.x/database/">< Database</a>
      
  
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
      
      
      
        
  
         <a class="Docs-page-nav__link u-last" href="/docs/v0.2.x/fixtures/">Fixtures ></a>
      
  
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
    
    
  
  
    
</div>

  </div>
</div>

      </div>
    </div>

    <footer class="Footer">
  <div class="Container Grid Grid--gutters Grid--full med-Grid--fit">
    <div class="Grid-cell">
      <p>Project and site maintained by <a href="https://twitter.com/samselikoff">Sam Selikoff</a> and <a href="https://github.com/samselikoff/ember-cli-mirage/graphs/contributors">contributors</a>.</p>
    </div>
    <div class="Grid-cell">
      <div class="Github-stars">
        <iframe src="https://ghbtns.com/github-btn.html?user=samselikoff&repo=ember-cli-mirage&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js"></script>
<script>
  /* global anchors */
  // anchors.options = {
  //   placement: 'left',
  //   visible: 'always'
  // };
  anchors.add('h2:not(.Home-page__feature-heading)');
</script>


  </body>
</html>
